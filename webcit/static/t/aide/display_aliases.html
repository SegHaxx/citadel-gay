<?=("head")><?%("COND:LOGGEDIN", 1, 1, 1, "", ="paging")>
<div id="banner">
<h1><a href="javascript:load_aliases()">&#8635;</a>
<?_("Global email aliases")></h1>
</div>
<div id="content" class="service">
<?!("COND:AIDE", 1)><?_("You need to be aide to view this.")><?!("X", 1)>
<??("COND:AIDE", 2)>

<div id="wc_easterbunny77">
</div>

<textarea name="global_aliases" id="global_aliases" VALUE="">
</textarea>

<script type="text/javascript">

load_aliases = async() => {
	response = await fetch("ajax_servcmd?g_cmd=LIST");
	data = await(response.text());
	populate_aliases(data);
};

function delete_alias(rowid) {
	var row = document.getElementById(rowid);
	row.parentNode.removeChild(row);
	repopulate_the_box();
}

function populate_aliases(data) {
	var a = "<table id=killo9867>";
	lines = data.split("\n");
	for (var i=1; i<lines.length && lines[i] != "000"; ++i) {
		config_line = lines[i].split("|");
		lineid = randomString(10);
		a +=	"<tr id=" + lineid + "><td>" + config_line[0] + "</td><td>" +
			config_line[1] + "</td><td>" +
			"<a href=\"javascript:delete_alias('" + lineid + "');\">" +
			"<font color=#FF0000>&#10006;</font></a></td></tr>";
	}
	a += "</table>";
	document.getElementById("wc_easterbunny77").innerHTML = a;
	repopulate_the_box();
}

function repopulate_the_box() {
	newbox = "";
	t = document.getElementById("killo9867");
	for (row of t.rows) {
		newbox += row.cells[0].innerHTML + " - " + row.cells[1].innerHTML + "\n";
	}
	document.getElementById("global_aliases").innerHTML = newbox;
}

load_aliases();

</script>


<??("X", 2)>
</div>
</div>
<?=("trailing")>
